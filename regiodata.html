<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbeidsmarkt Dashboard 2024-2028</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --twente-color: #c0392b;
            --twente-light: #e74c3c;
            --achterhoek-color: #27ae60;
            --achterhoek-light: #2ecc71;
            --bg: #f4f7f6;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        h1 { margin: 0; color: var(--primary); }
        p { color: #666; margin-top: 5px; }

        /* KPI Grid */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 5px solid var(--accent);
        }

        .kpi-card h3 { margin: 0 0 10px 0; font-size: 14px; color: #7f8c8d; text-transform: uppercase; }
        .kpi-card .value { font-size: 28px; font-weight: bold; color: var(--primary); }
        .kpi-card .sub { font-size: 13px; color: #95a5a6; }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
        }

        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .chart-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .chart-card h2 {
            margin-top: 0;
            font-size: 18px;
            color: var(--secondary);
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }

        /* Specifieke styling voor de dubbele doughnut chart */
        .dual-chart-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            height: 300px;
            width: 100%;
        }
        
        .chart-box {
            width: 45%;
            height: 100%;
            position: relative;
            text-align: center;
        }
        
        .chart-box h3 {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .charts-grid { grid-template-columns: 1fr; }
            .dual-chart-container {
                flex-direction: column;
                height: auto;
            }
            .chart-box {
                width: 100%;
                height: 250px;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>üìä Arbeidsmarktprognose 2024-2028</h1>
        <p>Inzichten voor regio's Twente & Achterhoek | Bron: AIS Arbeidsmarktinformatie</p>
    </div>

    <!-- KPI Kaarten -->
    <div class="kpi-grid" id="kpiContainer"></div>

    <div class="charts-grid">
        <!-- Grafiek 1: Instroom vs Vervanging (Full Width) -->
        <div class="chart-card full-width">
            <h2>‚öñÔ∏è Vraag vs. Aanbod: Twente & Achterhoek</h2>
            <p style="font-size: 0.9em; color: #666;">
                Vergelijking per opleidingsniveau. <br>
                <strong>Donkere balk</strong> = Vervangingsvraag (uitstroom). 
                <strong>Lichte balk</strong> = Instroom (nieuwe schoolverlaters).
            </p>
            <div class="chart-container">
                <canvas id="gapChart"></canvas>
            </div>
        </div>

        <!-- Grafiek 2: Sector Analyse -->
        <div class="chart-card">
            <h2>üìà Groeiverwachting per Sector</h2>
            <p style="font-size: 0.9em; color: #666;">Verwachte uitbreidingsvraag (groei) totaal over 6 jaar.</p>
            <div class="chart-container">
                <canvas id="sectorChart"></canvas>
            </div>
        </div>

        <!-- Grafiek 3: Regio Vergelijking -->
        <div class="chart-card">
            <h2>üåç Regio Profiel: Twente vs. Achterhoek</h2>
            <p style="font-size: 0.9em; color: #666;">Totaalbeeld van de drie kernindicatoren.</p>
            <div class="chart-container">
                <canvas id="radarChart"></canvas>
            </div>
        </div>

        <!-- Grafiek 4: Opleidingsniveau Detail (NU DUBBEL) -->
        <div class="chart-card full-width">
            <h2>üéì Instroom Schoolverlaters (Verdeling)</h2>
            <p style="font-size: 0.9em; color: #666;">Vergelijking van de instroom-mix per regio.</p>
            
            <div class="dual-chart-container">
                <div class="chart-box">
                    <h3>Twente</h3>
                    <canvas id="levelChartTwente"></canvas>
                </div>
                <div class="chart-box">
                    <h3>Achterhoek</h3>
                    <canvas id="levelChartAchterhoek"></canvas>
                </div>
            </div>
        </div>
    </div>

<script>
    // 1. DATA
    const csvData = `aggregatieniveau,detailniveau,thema,onderwerp,totaal 6 jr. %,gem. jaarlijks %,regionaam
opleidingssector (ONR2019),Mbo2 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,2,"0,3",Twente
opleidingssector (ONR2019),Mbo2 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,1",Achterhoek
opleidingssector (ONR2019),Mbo2 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,19,3,Twente
opleidingssector (ONR2019),Mbo2 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,11,"1,8",Achterhoek
opleidingssector (ONR2019),Mbo2 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,38,"5,6",Twente
opleidingssector (ONR2019),Mbo2 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,18,"2,9",Achterhoek
opleidingssector (ONR2019),Mbo2 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,1",Twente
opleidingssector (ONR2019),Mbo2 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-1,"-0,1",Achterhoek
opleidingssector (ONR2019),Mbo2 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,12,"1,9",Twente
opleidingssector (ONR2019),Mbo2 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,7,"1,1",Achterhoek
opleidingssector (ONR2019),Mbo2 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,53,"7,4",Twente
opleidingssector (ONR2019),Mbo2 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,2,"0,3",Achterhoek
opleidingssector (ONR2019),Mbo2 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,3,"0,6",Twente
opleidingssector (ONR2019),Mbo2 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,2",Achterhoek
opleidingssector (ONR2019),Mbo2 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,15,"2,4",Twente
opleidingssector (ONR2019),Mbo2 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,9,"1,4",Achterhoek
opleidingssector (ONR2019),Mbo2 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,72,"9,4",Twente
opleidingssector (ONR2019),Mbo2 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,40,"5,7",Achterhoek
opleidingssector (ONR2019),Mbo3 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,4,"0,6",Twente
opleidingssector (ONR2019),Mbo3 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,13,"2,1",Twente
opleidingssector (ONR2019),Mbo3 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,33,"4,8",Twente
opleidingssector (ONR2019),Mbo3 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,2,"0,3",Twente
opleidingssector (ONR2019),Mbo3 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-1,"-0,1",Achterhoek
opleidingssector (ONR2019),Mbo3 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,12,"1,9",Twente
opleidingssector (ONR2019),Mbo3 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,15,"2,4",Achterhoek
opleidingssector (ONR2019),Mbo3 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,20,"3,1",Twente
opleidingssector (ONR2019),Mbo3 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,17,"2,6",Achterhoek
opleidingssector (ONR2019),Mbo3 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,2,"0,4",Twente
opleidingssector (ONR2019),Mbo3 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,2",Achterhoek
opleidingssector (ONR2019),Mbo3 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,15,"2,4",Twente
opleidingssector (ONR2019),Mbo3 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,18,"2,8",Achterhoek
opleidingssector (ONR2019),Mbo3 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,29,"4,3",Twente
opleidingssector (ONR2019),Mbo3 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,47,"6,6",Achterhoek
opleidingssector (ONR2019),Mbo4 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,2,"0,3",Twente
opleidingssector (ONR2019),Mbo4 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,1",Achterhoek
opleidingssector (ONR2019),Mbo4 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,10,"1,6",Twente
opleidingssector (ONR2019),Mbo4 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,16,"2,5",Achterhoek
opleidingssector (ONR2019),Mbo4 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,17,"2,7",Twente
opleidingssector (ONR2019),Mbo4 - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,21,"3,2",Achterhoek
opleidingssector (ONR2019),Mbo4 - landbouw en natuur,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,2",Twente
opleidingssector (ONR2019),Mbo4 - landbouw en natuur,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,0,"-0,1",Achterhoek
opleidingssector (ONR2019),Mbo4 - landbouw en natuur,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,23,"3,5",Twente
opleidingssector (ONR2019),Mbo4 - landbouw en natuur,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,13,"2,1",Achterhoek
opleidingssector (ONR2019),Mbo4 - landbouw en natuur,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,16,"2,5",Twente
opleidingssector (ONR2019),Mbo4 - landbouw en natuur,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,12,"1,9",Achterhoek
opleidingssector (ONR2019),Mbo4 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-1,"-0,1",Twente
opleidingssector (ONR2019),Mbo4 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-2,"-0,4",Achterhoek
opleidingssector (ONR2019),Mbo4 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,23,"3,5",Twente
opleidingssector (ONR2019),Mbo4 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,27,4,Achterhoek
opleidingssector (ONR2019),Mbo4 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,23,"3,6",Twente
opleidingssector (ONR2019),Mbo4 - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,20,"3,1",Achterhoek
opleidingssector (ONR2019),Mbo4 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,3,"0,5",Twente
opleidingssector (ONR2019),Mbo4 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,2",Achterhoek
opleidingssector (ONR2019),Mbo4 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,17,"2,7",Twente
opleidingssector (ONR2019),Mbo4 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,14,"2,1",Achterhoek
opleidingssector (ONR2019),Mbo4 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,52,"7,2",Twente
opleidingssector (ONR2019),Mbo4 - zorg en dienstverlening,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,35,"5,1",Achterhoek
opleidingssector (ONR2019),Bachelor - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,2,"0,3",Twente
opleidingssector (ONR2019),Bachelor - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,0,0,Achterhoek
opleidingssector (ONR2019),Bachelor - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,12,"1,9",Twente
opleidingssector (ONR2019),Bachelor - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,19,"2,9",Achterhoek
opleidingssector (ONR2019),Bachelor - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,29,"4,3",Twente
opleidingssector (ONR2019),Bachelor - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,23,"3,5",Achterhoek
opleidingssector (ONR2019),Bachelor - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,0,"0,1",Twente
opleidingssector (ONR2019),Bachelor - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-2,"-0,4",Achterhoek
opleidingssector (ONR2019),Bachelor - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,17,"2,7",Twente
opleidingssector (ONR2019),Bachelor - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,38,"5,6",Achterhoek
opleidingssector (ONR2019),Bachelor - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,19,3,Twente
opleidingssector (ONR2019),Bachelor - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,20,3,Achterhoek
opleidingssector (ONR2019),Bachelor - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-2,"-0,3",Twente
opleidingssector (ONR2019),Bachelor - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-3,"-0,5",Achterhoek
opleidingssector (ONR2019),Bachelor - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,15,"2,4",Twente
opleidingssector (ONR2019),Bachelor - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,21,"3,2",Achterhoek
opleidingssector (ONR2019),Bachelor - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,25,"3,8",Twente
opleidingssector (ONR2019),Bachelor - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,34,5,Achterhoek
opleidingssector (ONR2019),Master - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,5,"0,8",Twente
opleidingssector (ONR2019),Master - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,2",Achterhoek
opleidingssector (ONR2019),Master - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,30,"4,5",Twente
opleidingssector (ONR2019),Master - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,38,"5,5",Achterhoek
opleidingssector (ONR2019),Master - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,17,"2,7",Twente
opleidingssector (ONR2019),Master - economie en maatschappij,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,4,"0,6",Achterhoek
opleidingssector (ONR2019),Master - landbouw en natuur,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-1,"-0,1",Twente
opleidingssector (ONR2019),Master - landbouw en natuur,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,16,"2,6",Twente
opleidingssector (ONR2019),Master - landbouw en natuur,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,36,"5,3",Twente
opleidingssector (ONR2019),Master - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,2",Twente
opleidingssector (ONR2019),Master - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,19,3,Twente
opleidingssector (ONR2019),Master - techniek en ict,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,30,"4,5",Twente
opleidingssector (ONR2019),Master - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-2,"-0,3",Twente
opleidingssector (ONR2019),Master - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,-4,"-0,6",Achterhoek
opleidingssector (ONR2019),Master - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,17,"2,7",Twente
opleidingssector (ONR2019),Master - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,28,"4,2",Achterhoek
opleidingssector (ONR2019),Master - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,27,4,Twente
opleidingssector (ONR2019),Master - zorg en onderwijs,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,22,"3,4",Achterhoek
opleidingssector (ONR2019),Totaal,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,1,"0,2",Twente
opleidingssector (ONR2019),Totaal,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte uitbreidingsvraag tot 2028,0,"-0,1",Achterhoek
opleidingssector (ONR2019),Totaal,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,21,"3,2",Twente
opleidingssector (ONR2019),Totaal,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte vervangingsvraag tot 2028,25,"3,9",Achterhoek
opleidingssector (ONR2019),Totaal,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,30,"4,5",Twente
opleidingssector (ONR2019),Totaal,Risicoindicatoren en arbeidsmarktprognoses tot 2028,verwachte instroom van schoolverlaters tot 2028,28,"4,2",Achterhoek`;

    // 2. PARSING LOGICA
    function parseCSV(csv) {
        const lines = csv.trim().split('\n');
        const result = [];
        
        for (let i = 1; i < lines.length; i++) {
            const matches = lines[i].match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
            if (!matches) continue;
            const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
            if(row.length < 7) continue;

            const region = row[6].trim();
            const rawValue = row[4]; 
            let value = 0;

            if (rawValue) {
                let cleanVal = rawValue.replace(/"/g, '').replace(',', '.');
                value = parseFloat(cleanVal);
                if (isNaN(value)) value = 0;
            }

            result.push({
                aggLevel: row[0].trim(),
                detail: row[1].trim(),
                subject: row[3].trim(),
                value: value,
                region: region
            });
        }
        return result;
    }

    const data = parseCSV(csvData);

    // Helpers
    const filterTotal = (subj, region) => data.find(d => d.subject.includes(subj) && d.region === region && d.detail === 'Totaal');

    // Kleuren definities
    const colTwenteDark = '#c0392b';
    const colTwenteLight = '#e74c3c';
    const colAchterhoekDark = '#27ae60';
    const colAchterhoekLight = '#2ecc71';

    // --- KPI KAARTEN ---
    const kpiContainer = document.getElementById('kpiContainer');
    const metrics = [
        { title: 'Uitbreidingsvraag (Twente)', key: 'uitbreidingsvraag', region: 'Twente', color: colTwenteLight },
        { title: 'Uitbreidingsvraag (Achterhoek)', key: 'uitbreidingsvraag', region: 'Achterhoek', color: colAchterhoekLight },
        { title: 'Vervangingsvraag (Twente)', key: 'vervangingsvraag', region: 'Twente', color: colTwenteLight },
        { title: 'Vervangingsvraag (Achterhoek)', key: 'vervangingsvraag', region: 'Achterhoek', color: colAchterhoekLight },
    ];

    metrics.forEach(m => {
        const item = filterTotal(m.key, m.region);
        if(item) {
            const div = document.createElement('div');
            div.className = 'kpi-card';
            div.style.borderLeftColor = m.color;
            div.innerHTML = `<h3>${m.title}</h3><div class="value">${item.value}%</div><div class="sub">Totaal over 6 jaar</div>`;
            kpiContainer.appendChild(div);
        }
    });

    // --- ALGEMEEN DATA AGGREGATIE ---
    const levels = ['Mbo2', 'Mbo3', 'Mbo4', 'Bachelor', 'Master'];
    
    function getAggregatedData(region, subjectSnippet) {
        return levels.map(lvl => {
            const items = data.filter(d => d.region === region && d.subject.includes(subjectSnippet) && d.detail.startsWith(lvl));
            const sum = items.reduce((a, b) => a + b.value, 0);
            return items.length ? (sum / items.length).toFixed(1) : 0;
        });
    }

    // --- GRAFIEK 1: GAP ANALYSIS (Twente EN Achterhoek) ---
    const ctxGap = document.getElementById('gapChart').getContext('2d');
    new Chart(ctxGap, {
        type: 'bar',
        data: {
            labels: levels,
            datasets: [
                {
                    label: 'Vervanging (Twente)',
                    data: getAggregatedData('Twente', 'vervangingsvraag'),
                    backgroundColor: '#a93226',
                    borderWidth: 0
                },
                {
                    label: 'Instroom (Twente)',
                    data: getAggregatedData('Twente', 'instroom'),
                    backgroundColor: '#e74c3c', 
                    borderWidth: 0
                },
                {
                    label: 'Vervanging (Achterhoek)',
                    data: getAggregatedData('Achterhoek', 'vervangingsvraag'),
                    backgroundColor: '#1e8449',
                    borderWidth: 0
                },
                {
                    label: 'Instroom (Achterhoek)',
                    data: getAggregatedData('Achterhoek', 'instroom'),
                    backgroundColor: '#2ecc71',
                    borderWidth: 0
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            scales: { y: { beginAtZero: true } }
        }
    });

    // --- GRAFIEK 2: SECTOR UITBREIDINGSVRAAG ---
    const rawSectors = [...new Set(data.filter(d => d.detail !== 'Totaal').map(d => {
        const parts = d.detail.split(' - ');
        return parts.length > 1 ? parts[1] : parts[0];
    }))];
    const sectors = [...new Set(rawSectors)].slice(0, 7); 

    function getSectorData(region) {
        return sectors.map(sec => {
            const items = data.filter(d => d.region === region && d.detail.includes(sec) && d.subject.includes('uitbreidingsvraag'));
            const sum = items.reduce((a, b) => a + b.value, 0);
            return items.length ? (sum / items.length).toFixed(1) : 0;
        });
    }

    const ctxSector = document.getElementById('sectorChart').getContext('2d');
    new Chart(ctxSector, {
        type: 'bar',
        indexAxis: 'y', 
        data: {
            labels: sectors,
            datasets: [
                { label: 'Twente', data: getSectorData('Twente'), backgroundColor: colTwenteLight },
                { label: 'Achterhoek', data: getSectorData('Achterhoek'), backgroundColor: colAchterhoekLight }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { x: { grid: { color: '#eee' } } }
        }
    });

    // --- GRAFIEK 3: RADAR CHART ---
    const radarLabels = ['Uitbreidingsvraag', 'Vervangingsvraag', 'Instroom Schoolverlaters'];
    const radarDataTwente = [
        filterTotal('uitbreidingsvraag', 'Twente')?.value || 0,
        filterTotal('vervangingsvraag', 'Twente')?.value || 0,
        filterTotal('instroom', 'Twente')?.value || 0
    ];
    const radarDataAchterhoek = [
        filterTotal('uitbreidingsvraag', 'Achterhoek')?.value || 0,
        filterTotal('vervangingsvraag', 'Achterhoek')?.value || 0,
        filterTotal('instroom', 'Achterhoek')?.value || 0
    ];

    const ctxRadar = document.getElementById('radarChart').getContext('2d');
    new Chart(ctxRadar, {
        type: 'radar',
        data: {
            labels: radarLabels,
            datasets: [
                {
                    label: 'Twente',
                    data: radarDataTwente,
                    fill: true,
                    backgroundColor: 'rgba(231, 76, 60, 0.2)',
                    borderColor: colTwenteLight,
                    pointBackgroundColor: colTwenteLight
                },
                {
                    label: 'Achterhoek',
                    data: radarDataAchterhoek,
                    fill: true,
                    backgroundColor: 'rgba(39, 174, 96, 0.2)',
                    borderColor: colAchterhoekLight,
                    pointBackgroundColor: colAchterhoekLight
                }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    // --- GRAFIEK 4: DUBBELE DOUGHNUT ---
    const bgColors = ['#f1c40f', '#e67e22', '#e74c3c', '#9b59b6', '#34495e'];
    
    // Data Twente
    const inflowDataTwente = levels.map(lvl => {
        const val = getAggregatedData('Twente', 'instroom')[levels.indexOf(lvl)];
        return parseFloat(val);
    });

    // Data Achterhoek
    const inflowDataAchterhoek = levels.map(lvl => {
        const val = getAggregatedData('Achterhoek', 'instroom')[levels.indexOf(lvl)];
        return parseFloat(val);
    });

    // Chart Twente
    new Chart(document.getElementById('levelChartTwente').getContext('2d'), {
        type: 'doughnut',
        data: {
            labels: levels,
            datasets: [{
                data: inflowDataTwente,
                backgroundColor: bgColors,
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } }
        }
    });

    // Chart Achterhoek
    new Chart(document.getElementById('levelChartAchterhoek').getContext('2d'), {
        type: 'doughnut',
        data: {
            labels: levels,
            datasets: [{
                data: inflowDataAchterhoek,
                backgroundColor: bgColors,
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } }
        }
    });

</script>

</body>
</html>
